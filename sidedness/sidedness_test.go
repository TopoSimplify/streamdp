package sidedness

import (
	"testing"
	"github.com/franela/goblin"
	"github.com/intdxdt/geom"
	"time"
)

func TestSidedness(t *testing.T) {
	g := goblin.Goblin(t)
	g.Describe("homotopic sidedness test", func() {
		g.It("should test sidedness to a context geometry", func() {
			g.Timeout(1 * time.Hour)
			var cwkt = "POLYGON (( 278 307, 270 298, 274 286, 279 272, 301 274, 308 288, 311 304, 296 308, 278 307 ))"
			var wkt = "LINESTRING ( 155 171, 207 166, 253 175, 317 171, 367 182, 400 200, 428 249, 417 291, 383 324, 361 332, 333 347, 314 357, 257 383, 204 370, 176 337, 180 305, 214 295, 244 302, 281 332, 316 328, 331 306, 332 291, 315 265, 285 250, 247 261, 231 276, 195 264, 187 230, 216 215, 257 226, 273 217, 273 205, 240 197, 200 200, 178 193, 157 226, 156 246, 151 263, 120 264, 95 249, 89 261, 100 300, 116 359, 139 389, 172 413, 211 425, 256 430, 289 431, 348 427 )"
			var coords = geom.NewLineStringFromWKT(wkt).Coordinates()
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsTrue()

			cwkt = "POLYGON (( 221 347, 205 334, 221 322, 234 324, 237 342, 221 347 ))"

			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsFalse()

			cwkt = "POLYGON (( 221 347, 205 334, 221 322, 234 324, 237 342, 221 347 ))"
			wkt = "LINESTRING ( 155 171, 207 166, 253 175, 317 171, 366.3526316090967 196.8011373660995, 403.24889098928804 217.07380735521562, 449.06512516469047 258.02460073323016, 469.7432485535889 310.7335427049321, 431.6306289740506 348.8461622844704, 393.9234627942946 354.9279632812052, 371.21807240648457 309.92263590536743, 372.43443260583155 253.97006673540696, 415.4124929827577 249.91553273758373, 425.14337457753345 316.00443690210227, 404.465251188635 331.81711949361284, 359.0544704130149 294.10995331385686, 333 347, 365.94717820931436 412.50234605029505, 350.9454024173684 441.6949908346222, 269.44926906112164 441.6949908346222, 233.36391648049494 444.9386180328808, 205.38763189551466 402.77146445551926, 204 370, 176 337, 180 305, 214 295, 244 302, 281 332, 316 328, 331 306, 332 291, 315 265, 285 250, 247 261, 231 276, 195 264, 187 230, 216 215, 257 226, 273 217, 273 205, 240 197, 200 200, 178 193, 157 226, 156 246, 151 263, 120 264, 95 249, 89 261, 100 300, 116 359, 139 389, 172 413, 211 425, 256 430, 289 431, 348 427 )"
			coords = geom.NewLineStringFromWKT(wkt).Coordinates()
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsFalse()
			cwkt = "POLYGON (( 278 307, 270 298, 274 286, 279 272, 301 274, 308 288, 311 304, 296 308, 278 307 ))"
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsTrue()

			wkt = "LINESTRING ( 155 171, 207 166, 253 175, 317 171, 366.3526316090967 196.8011373660995, 403.24889098928804 217.07380735521562, 449.2399093677868 286.1290060157034, 451.783228702019 325.7276851722446, 415.8591984439269 355.71930167053, 418.6880722510337 402.11283210708103, 389.8335594185446 420.2176244725644, 350.9454024173684 441.6949908346222, 269.44926906112164 441.6949908346222, 233.36391648049494 444.9386180328808, 205.38763189551466 402.77146445551926, 204 370, 176 337, 180 305, 157 226, 95 249, 89 261, 100 300, 116 359, 139 389, 172 413, 211 425, 256 430, 289 431, 348 427 )"
			cwkt = "POLYGON (( 278 307, 270 298, 274 286, 279 272, 301 274, 308 288, 311 304, 296 308, 278 307 ))"
			coords = geom.NewLineStringFromWKT(wkt).Coordinates()
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsFalse()
			cwkt = "POLYGON (( 221 347, 205 334, 221 322, 234 324, 237 342, 221 347 ))"
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsTrue()

			coords = []*geom.Point{{2, 2}, {5, 2}, {7, 2}, {9, 2}}
			var lnconst = geom.NewLineString([]*geom.Point{{3, 2}, {6, 2}, {6.5, 2}})
			g.Assert(
				Homotopy(coords, lnconst),
			).IsTrue()
			var plyconst = geom.NewPolygon([]*geom.Point{{4, 1}, {4, 3}, {5, 3}, {5, 1}})
			g.Assert(
				Homotopy(coords, plyconst),
			).IsTrue()

			wkt = "LINESTRING ( 155 171, 207 166, 253 175, 317 171, 367 182, 400 200, 428 249, 417 291, 383 324, 361 332, 333 347, 314 357, 257 383, 204 370, 176 337, 180 305, 214 295, 244 302, 281 332, 316 328, 331 306, 332 291, 315 265, 285 250, 247 261, 231 276, 175.9815455950541 265.3822256568778, 187 230, 233.38568778979908 233.9203400309118, 265.9514992272025 234.4723029366305, 274.230942812983 207.97808346213282, 248.54273709311704 199.72323889171014, 215.17091190108192 192.52312210200918, 219.58661514683152 241.09585780525492, 203.57969088098918 278.07737248840795, 222.34642967542504 355.9041421947449, 211 425, 256 430, 289 431, 348 427 )"
			cwkt = "POLYGON (( 278 307, 268.711313755796 290.77251931993817, 235.45711654915712 296.5278817518552, 232.8337248840804 286.90877897990725, 277.40587928436713 278.46806414206173, 285.4987949850666 282.69941864135717, 288.58197836166926 290.77251931993817, 290.2378670788254 299.05196290571865, 278 307 ))"
			coords = geom.NewLineStringFromWKT(wkt).Coordinates()
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsTrue()

			wkt = "LINESTRING ( 155 171, 207 166, 253 175, 317 171, 367 182, 400 200, 428 249, 417 291, 383 324, 361 332, 333 347, 314 357, 257 383, 204 370, 176 337, 180 305, 205.2355795981453 296.29214837712516, 244 302, 281 332, 316 328, 331 306, 332 291, 315 265, 285 250, 247 261, 231 276, 175.9815455950541 265.3822256568778, 187 230, 233.38568778979908 233.9203400309118, 265.9514992272025 234.4723029366305, 274.230942812983 207.97808346213282, 248.54273709311704 199.72323889171014, 215.17091190108192 192.52312210200918, 219.58661514683152 241.09585780525492, 203.57969088098918 278.07737248840795, 225.65820710973728 312.29907264296753, 246.63279752704796 324.99421947449764, 255.46420401854718 354.24825347758883, 223.45035548686246 391.22976816074186, 233.93765069551782 421.58772797527047, 256 430, 289 431, 348 427 )"
			cwkt = "POLYGON (( 221 347, 205 334, 221 322, 234 324, 237 342, 221 347 ))"
			coords = geom.NewLineStringFromWKT(wkt).Coordinates()
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsFalse()

			wkt = "LINESTRING ( 155 171, 207 166, 253 175, 317 171, 367 182, 400 200, 428 249, 417 291, 383 324, 361 332, 333 347, 314 357, 257 383, 204 370, 176 337, 180 305, 205.2355795981453 296.29214837712516, 244 302, 281 332, 316 328, 331 306, 332 291, 315 265, 285 250, 247 261, 231 276, 175.9815455950541 265.3822256568778, 187 230, 233.38568778979908 233.9203400309118, 265.9514992272025 234.4723029366305, 274.230942812983 207.97808346213282, 248.54273709311704 199.72323889171014, 215.17091190108192 192.52312210200918, 219.58661514683152 241.09585780525492, 203.57969088098918 278.07737248840795, 225.65820710973728 312.29907264296753, 246.63279752704796 324.99421947449764, 255.46420401854718 354.24825347758883, 223.45035548686246 391.22976816074186, 233.93765069551782 421.58772797527047, 256 430, 289 431, 348 427 )"
			cwkt = "POLYGON (( 232.00298146975462 210.52416263821522, 232.00298146975462 220.68605060410567, 246.51996427816957 220.68605060410567, 246.51996427816957 210.52416263821522, 232.00298146975462 210.52416263821522 ))"
			coords = geom.NewLineStringFromWKT(wkt).Coordinates()
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsTrue()

			wkt = "LINESTRING ( 155 171, 207 166, 253 175, 317 171, 367 182, 400 200, 428 249, 417 291, 383 324, 361 332, 333 347, 314 357, 257 383, 204 370, 176 337, 180 305, 205.2355795981453 296.29214837712516, 244 302, 281 332, 316 328, 331 306, 332 291, 315 265, 285 250, 247 261, 231 276, 175.9815455950541 265.3822256568778, 187 230, 233.38568778979908 233.9203400309118, 265.9514992272025 234.4723029366305, 274.230942812983 207.97808346213282, 248.54273709311704 199.72323889171014, 215.17091190108192 192.52312210200918, 219.58661514683152 241.09585780525492, 203.57969088098918 278.07737248840795, 225.65820710973728 312.29907264296753, 246.63279752704796 324.99421947449764, 255.46420401854718 354.24825347758883, 223.45035548686246 391.22976816074186, 233.93765069551782 421.58772797527047, 256 430, 289 431, 348 427 )"
			cwkt = "POLYGON (( 211.34885547628429 235.3767011676454, 211.34885547628429 241.48063878287113, 213.69652378983264 241.48063878287113, 213.69652378983264 235.3767011676454, 211.34885547628429 235.3767011676454 ))"
			coords = geom.NewLineStringFromWKT(wkt).Coordinates()
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsTrue()

			wkt = "LINESTRING ( 155 171, 207 166, 253 175, 317 171, 367 182, 400 200, 428 249, 417 291, 383 324, 361 332, 333 347, 314 357, 257 383, 204 370, 176 337, 180 305, 205.2355795981453 296.29214837712516, 244 302, 281 332, 316 328, 331 306, 332 291, 315 265, 285 250, 247 261, 231 276, 175.9815455950541 265.3822256568778, 187 230, 233.38568778979908 233.9203400309118, 265.9514992272025 234.4723029366305, 274.230942812983 207.97808346213282, 248.54273709311704 199.72323889171014, 215.17091190108192 192.52312210200918, 203.26715129630935 235.02274990598545, 211.59588065682914 246.07018366916196, 217.04481846253088 253.29779029226893, 222.32389329119033 260.30008643805553, 226.53649692090931 265.8877886619315, 203.57969088098918 278.07737248840795, 225.65820710973728 312.29907264296753, 246.63279752704796 324.99421947449764, 255.46420401854718 354.24825347758883, 223.45035548686246 391.22976816074186, 233.93765069551782 421.58772797527047, 256 430, 289 431, 348 427 )"
			cwkt = "POLYGON (( 211.34885547628429 235.3767011676454, 211.34885547628429 241.48063878287113, 213.69652378983264 241.48063878287113, 213.69652378983264 235.3767011676454, 211.34885547628429 235.3767011676454 ))"
			coords = geom.NewLineStringFromWKT(wkt).Coordinates()
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsFalse()

			wkt = "LINESTRING ( 155 171, 207 166, 253 175, 317 171, 367 182, 400 200, 428 249, 417 291, 383 324, 361 332, 333 347, 314 357, 257 383, 204 370, 176 337, 180 305, 205.2355795981453 296.29214837712516, 244 302, 281 332, 316 328, 331 306, 332 291, 315 265, 285 250, 247 261, 231 276, 175.9815455950541 265.3822256568778, 187 230, 233.38568778979908 233.9203400309118, 265.9514992272025 234.4723029366305, 274.230942812983 207.97808346213282, 248.54273709311704 199.72323889171014, 215.17091190108192 192.52312210200918, 203.26715129630935 235.02274990598545, 211.59588065682914 246.07018366916196, 217.04481846253088 253.29779029226893, 222.32389329119033 260.30008643805553, 226.53649692090931 265.8877886619315, 348 427 )"
			cwkt = "POLYGON (( 211.34885547628429 235.3767011676454, 211.34885547628429 241.48063878287113, 213.69652378983264 241.48063878287113, 213.69652378983264 235.3767011676454, 211.34885547628429 235.3767011676454 ))"
			coords = geom.NewLineStringFromWKT(wkt).Coordinates()
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsFalse()

			wkt = "LINESTRING ( 155 171, 169.0211940381559 189.5980604858441, 178.36905451652774 201.99729511000572, 189.61729454361603 216.9172404309104, 155.33584906460158 235.98971111300912, 171.9249231022847 253.04608301090866, 184.81805947947288 266.3024063282993, 199.21035949720948 260.0405937778234, 216.46768369629606 252.53226438472433, 226.72184529093568 266.1336393496349, 253.77293550266072 261.8918612097899, 286.55244753078927 256.75183112348185, 298.89980243113513 277.3307559573916, 308.9755371420998 294.1236471423328, 311.6569923092747 322.2091261672002, 274.3587106022468 329.32036224961234, 286.70927127817396 345.7024530943654, 302.96002907406313 367.25786239875725, 265.3750851201071 385.89221758862226, 267.0360547209449 409.9762768007707, 292.87995239405126 407.8640164833156, 311.8206399330813 406.3159658301186, 333.85824574639133 408.2420254459906, 348 427 )"
			cwkt = "POLYGON (( 211.34885547628429 235.3767011676454, 211.34885547628429 241.48063878287113, 213.69652378983264 241.48063878287113, 213.69652378983264 235.3767011676454, 211.34885547628429 235.3767011676454 ))"
			coords = geom.NewLineStringFromWKT(wkt).Coordinates()
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsTrue()

			wkt = "LINESTRING ( 90 270, 120 270, 150 270, 190 220, 150 230, 180 250, 180 270, 200 250, 210 270, 230 260, 250 270, 280 270, 300 270, 310 290, 310 320, 400 270, 380 270, 340 270, 380 310, 410 270, 450 310, 430 270, 470 270 )"
			cwkt = "POLYGON (( 211.34885547628429 235.3767011676454, 211.34885547628429 241.48063878287113, 213.69652378983264 241.48063878287113, 213.69652378983264 235.3767011676454, 211.34885547628429 235.3767011676454 ))"
			coords = geom.NewLineStringFromWKT(wkt).Coordinates()
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsTrue()

			wkt = "LINESTRING ( 90 270, 470 270 )"
			cwkt = "POLYGON (( 211.34885547628429 235.3767011676454, 211.34885547628429 241.48063878287113, 213.69652378983264 241.48063878287113, 213.69652378983264 235.3767011676454, 211.34885547628429 235.3767011676454 ))"
			coords = geom.NewLineStringFromWKT(wkt).Coordinates()
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsTrue()

			wkt = "LINESTRING ( 90 270, 470 270 )"
			cwkt = "POLYGON (( 370 260, 370 300, 380 300, 380 260, 370 260 ))"
			coords = geom.NewLineStringFromWKT(wkt).Coordinates()
			g.Assert(
				Homotopy(coords, geom.NewPolygonFromWKT(cwkt)),
			).IsTrue()

		})

	})
}
